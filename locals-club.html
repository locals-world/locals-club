<!--
@license
Copyright (c) 2016 A-labs. All rights reserved.
/////////////////
LOCALS
/////////////////
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../locals-object/locals-object.html">
<link rel="import" href="../locals-object/locals-dataobject.html">
<link rel="import" href="../locals-loader/locals-dataloader.html">

<!--
Locals residence : a residence object.

Example:

    <locals-club
      visualstate="{{visualstate}}"
      datastate="{{datastate}}"
      on-visual-state-changed="visualstateupdated"
      on-data-state-changed="datastateupdated">     
    </locals-club>

@demo demo/index.html
@hero hero.svg
-->

<dom-module id="locals-club">
  <template>
<style>
      :host {
        display: block;
        box-sizing: border-box;
        color: black;
        --preview-title:20px;
        --clubname-size:24px;
        --clubavatar-size:40px;
        --closed-padding: 10px;        
/*        --valids-color: var(--locals-blue);
        --view-title:24px;
        --view-lineheight:44px;
        --line-height2:28px; 
        --inner-padding: 20px 0px 20px 0px;*/
        background-color: white;
        width: 100%;
        @apply(--layout-vertical);
        @apply(--layout-center-center);

      }

      h1 {
        @apply(--locals-font-h1);
        font-size: var(--view-title);
        line-height: var(--view-lineheight);
        margin: 0px;
      }
/*      h2 {
        @apply(--locals-font-h2);
      }*/
      p {
        @apply(--locals-font-body1);
      }
      small {
        @apply(--locals-font-small);
      }


      .preview {
        width: 100%;
        max-width: 90vw;
        @apply(--layout-horizontal);
        @apply(--layout-start);
        @apply(--layout-start-justified);
        box-sizing: border-box;
        padding: var(--closed-padding);
        border-bottom: 2px solid rgba(0,0,0,0.05);

      }

      .previewavatar {
        width: 40px;
        height: 40px;
        min-width: 40px;
        min-height: 40px;
        box-sizing: border-box;
        padding: 10px;
        border-radius: 50%;
        margin: 0px 20px 0px 0px;
        background-color: var(--locals-grey1);
      }

      .previewvals {
/*        @apply(--layout-flex);*/
      width: 100%; 
      max-width: 80vw; 
        @apply(--layout-horizontal);
        @apply(--layout-start);
      }

      .previewvals h2 {
        margin: 5px 0px  0px 0px;
        @apply(--opensans-light);
        font-size: var(--preview-title);
        color: var(--locals-grey7);
      }

      .clubinfototal {
        width: 100%;
        @apply(--layout-horizontal);
        @apply(--layout-start);
        @apply(--layout-start-justified);
        box-sizing: border-box;
        padding: var(--open-padding);
        border-bottom: 2px solid rgba(0,0,0,0.05);
      }


      .clubinfo {
        width: 100%;
        @apply(--layout-vertical);
        @apply(--layout-start);
        @apply(--layout-start-justified);
        @apply(--layout-flex);

      }

      .clubavatar {
        width: var(--clubavatar-size);
        height: var(--clubavatar-size);
        box-sizing: border-box;
        padding: 10px;
        border-radius: 50%;
        margin: 0px 20px 0px 0px;
        background-color: var(--locals-grey1);
      }


      .clubinfo h2 {
        @apply(--opensans-light);
        margin: 0px 0px 10px 0px;
        font-size: var(--clubname-size);
        color: var(--locals-grey7);
      }

      .extrainfo {
        width: 100%;
        @apply(--layout-horizontal);
        @apply(--layout-center);
        @apply(--layout-start-justified);
        @apply(--layout-wrap);
      }

      .clubmoneys {
        color: var(--locals-blue);

      }

      .clubcreated {
        
      }

      .localcoinamount {
        margin: 0px 0px -3px 2px;
      }

      .creating {
        opacity: 0.5;
      }

      .creatingmsg {
        color:var(--locals-blue); 
        margin: 6px 0px 0px 0px;
      }

/*      .failed h2 {
        color:var(--locals-red);
      }*/


      .failedmsg p {
        color:var(--locals-red);
        font-size: 14px;
        line-height: 18px;
        @apply(--opensans-semibold); 
        margin: 6px 0px 0px 0px;
      }

      .failedicon {
        border-radius: 50px;
        height: 15px;
        width: 15px;
        min-height: 15px;
        min-width: 15px;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
        border: 1px solid var(--locals-red);
        color:var(--locals-red);
        margin: 10px 20px 0px 10px;
      }

      .detail {
        margin: 10px 10px 0px 0px;
        height: 25px;
        width: 25px;
        min-height: 25px;
        min-width: 25px;
      }


      </style>

  <template is="dom-if" if="{{_is(renderstate,'closed')}}">

  <template is="dom-if" if="{{_is(status,'creating')}}">
    <div class="preview">
      <div class="previewavatar creating">
      </div>
      <div class="previewvals creating" on-tap="_toEdit">
        <h2>{{datastate.name}}</h2>
      </div>
      <div class="creatingmsg">
      <locals-loader small>Creating</locals-loader>
      </div>
    </div>
  </template>


  <template is="dom-if" if="{{_is(status,'created')}}">
    <div class="preview">
      <div class="previewavatar">
      </div>
      <div class="previewvals" on-tap="_toEdit">
        <h2>{{datastate.name}}</h2>
      </div>
    </div>
  </template>

  <template is="dom-if" if="{{_is(status,'failed')}}">
    <div class="preview">
      <div class="previewavatar failed">
      </div>
      <div class="previewvals failed" on-tap="_toEdit">
        <h2>{{datastate.name}}</h2>
        <div class="failedicon">!</div>
      </div>
      <div class="failedmsg">
        <p>Creating failed</p>
      </div>
    </div>
  </template>

  </template>



  <template is="dom-if" if="{{_is(renderstate,'open')}}">
    <template is="dom-if" if="{{_is(status,'creating')}}">
      <div class="clubinfototal">
        <div class="clubavatar">
        </div>
        <div class="clubinfo" on-tap="_toEdit">
          <h2>{{datastate.name}}</h2>
          <div class="extrainfo">
            <locals-loader small>Creating your club</locals-loader>
          </div>
        </div>
        </div>
      </div>
    </template>

    <template is="dom-if" if="{{_is(status,'created')}}">
      <div class="clubinfototal">
        <div class="clubavatar">
        </div>
        <div class="clubinfo" on-tap="_toEdit">
          <h2>{{datastate.name}}</h2>
          <div class="extrainfo">
            <div class="clubmoneys">
              <p>2<locals-icon veryverysmall icon="localcoin" iconcolor="blue" class="localcoinamount"></locals-icon></p>
            </div>
            <div class="clubmembers">
            </div>
            <div class="clubcreated">
            </div>
          </div>
        </div>
      </div>
    </template>

    <template is="dom-if" if="{{_is(status,'failed')}}">
      <div class="clubinfototal">
        <div class="clubavatar">
        </div>
        <div class="clubinfo" on-tap="_toEdit">
          <h2>{{datastate.name}}</h2>
          <div class="extrainfo">
            <div class="failedicon detail">!</div>
            <div class="failedmsg">
              <p>The creating of your club failed because you're out of LocalCoin, you cheapstake.</p>
            </div>
          </div>
        </div>
        </div>
      </div>
    </template>


  </template>


<!--    <locals-object on-internalstatechange="_fixdata" config="[[config]]" objectdata="[[objectdata]]" state="{{visualstate}}" on-state-changed="_visualstatechanged" renderstate="{{renderstate}}"></locals-object>
   <locals-dataobject id="ldataobject" hashfunction="{{hashfunction}}" on-state-changed="_datastatechanged" objectdata="[[objectdata]]" state="{{datastate}}" config="[[dataconfig]]" renderstate="{{renderstate}}"></locals-dataobject> -->

  </template>

  <script>
    Polymer({
      is: 'locals-club',

      properties: {
        _version: {
          type: String,
          value: '0.0.1'
        },
        /* Configuration of the avatar's visual state.
        can be set on initialisation - data is returned to this variable.
        */
        visualstate: {
          type: Array,
          notify: true,
          value: [ [ 0, 0 ] ]
        },
        /* configuration of the object's data state.
         can be set on initialisation - data is returned to this variable
        */
        datastate: {
          type: Object,
          notify: true,
          value: {
              "name": "Mijn Club",
            },
          observer: '_datastate'

        },

        renderstate: {
          type: String          
        },

        status: {
          type: String          
        },

        sizeview: {
          type: String,
          observer: '_sizeview'
        },

        objectdata: {
          type: Object,
          observer: '_objectdata'

        },
        hashfunction: {
          type: Function
        }
      },

      _newblock: function(){
       
      },

      _is: function(a, b) {
        if (b === undefined){
          b = true;
        }
        return a === b;
      },


      _fixdata: function(e){
        // console.log('fix data',e.detail);

        // console.log('color of body',e.detail[this.layerindex['body']][1]);
        // console.log('color of head',e.detail[this.layerindex['head']][1]);

        // copy head color to body color
        // if (e.detail[this.layerindex['head']][1] != e.detail[this.layerindex['body']][1]){
        //   e.detail[this.layerindex['head']][1] = e.detail[this.layerindex['body']][1];
        //   this.visualstate = e.detail;
        // }

      },

      // Element Lifecycle
      ready: function() {
        this.status = "creating";

        this.dataconfig = {
          fields: [
            {
              name: "name",
              type: "input",
              label: "Name"
            }
          ]
        };

        this.config = 
{ layers: 
   [ { name: 'club',
       icon: this.resolveUrl("./images/residence-icon.png"),
       iconselected: this.resolveUrl("./images/residence-icon-selected.png"),
       variants: [ 'basic', 'hirise', 'lorise', 'mansion' ],
       colors: [ 'nocolor' ],
       images: 
        { 'basic-nocolor': this.resolveUrl("./images/0-residence-residence-basic-nocolor.png"),
          'hirise-nocolor': this.resolveUrl("./images/0-residence-residence-hirise-nocolor.png"),
          'lorise-nocolor': this.resolveUrl("./images/0-residence-residence-lorise-nocolor.png"),
          'mansion-nocolor': this.resolveUrl("./images/0-residence-residence-mansion-nocolor.png") } } ],
  defaultstate: [ [ 0, 0 ] ] }


;

  this.layerindex = {};

    var self= this;
      // make some layers invisible
      this.config.layers = this.config.layers.map(function(layer,index){
        self.layerindex[layer.name] = index;
        // if (layer.name == 'head' || layer.name == 'facemale'){
        //   layer.hidden = true;
        // }
        return layer;
      });


        if (!this.visualstate) {
          // default state
          this.visualstate = this.config.defaultstate;
        }

        if (!this.datastate) {
          this.datastate = {
              "name": "",
          };
        }


      },

      attached: function() {
        //var user = document.querySelector('locals-user');
        var self = this;
        //debugger;
        // if (this.renderstate !== 'dataview'){
        //   user.addEventListener('newblock', function() {
        //     var validations = self.$.ldataobject.getValidations();
        //   });          
        // }
      },

      detached: function() {
        // The analog to `attached`, `detached` fires when the element has been
        // removed from a document.
        //
        // Use this to clean up anything you did in `attached`.
      },

      _visualstatechanged: function(e) {
        //console.log('Visual state changed');
        this.fire('visual-state-changed',e.detail);
      },

      _datastatechanged: function(e) {
        console.log('Data state changed',e.detail);
        this.fire('data-state-changed',e.detail);
      },

      _datastate: function() {
        console.log("HIIIIEERPPPP", JSON.stringify(this.datastate));
      },




    _sizeview: function(){
        switch(this.sizeview) {
            case 'phone':
              this.customStyle['--preview-title'] = '20px';
              this.customStyle['--clubname-size'] = '24px';
              this.customStyle['--clubavatar-size'] = '40px';
              this.customStyle['--closed-padding'] = '4vh 2vw 4vh 2vw';
              this.customStyle['--open-padding'] = '0vw 8vw 8vw 8vw';
              this.updateStyles();
              break;
            case 'desktop':
              this.customStyle['--preview-title'] = '20px';
              this.customStyle['--clubname-size'] = '30px';
              this.customStyle['--clubavatar-size'] = '48px';
              this.customStyle['--closed-padding'] = '6vh 2vw 6vh 2vw';
              this.customStyle['--open-padding'] = '0vw 2vw 2vw 2vw';
              this.updateStyles();
              break;
            case 'xlarge':
              this.customStyle['--preview-title'] = '22px';
              this.customStyle['--clubname-size'] = '36px';
              this.customStyle['--clubavatar-size'] = '48px';
              this.customStyle['--closed-padding'] = '6vh 2vw 6vh 2vw';
              this.customStyle['--open-padding'] = '0vw 2vw 2vw 2vw';
              this.updateStyles();
              break;
            default:
            //console.log("!!! ** Niks");
        }
      },






    });
  </script>
</dom-module>
